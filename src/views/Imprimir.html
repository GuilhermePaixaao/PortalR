<!DOCTYPE html>
<html lang="pt-br">
<head>
ย ย <meta charset="UTF-8">
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0">
ย ย <title>Impressรฃo de Preรงos</title>

ย ย <script>
ย ย ย ย // --- INรCIO DO PROTETOR DE PรGINA (ANTI-FLICKER) ---
ย ย ย ย const userDataString = localStorage.getItem("userData");
ย ย ย ย 
ย ย ย ย if (!userDataString) {
ย ย ย ย ย ย window.location.replace("Login.html"); 
ย ย ย ย ย ย throw new Error("Usuรกrio nรฃo autenticado.");
ย ย ย ย }
ย ย ย ย try {
ย ย ย ย ย ย const userData = JSON.parse(userDataString);
ย ย ย ย ย ย if (!userData?.data?.id) {
ย ย ย ย ย ย ย ย throw new Error("Dados de usuรกrio invรกlidos.");
ย ย ย ย ย ย }
ย ย ย ย } catch (error) {
ย ย ย ย ย ย console.error("Sessรฃo invรกlida:", error.message);
ย ย ย ย ย ย localStorage.removeItem("userData"); 
ย ย ย ย ย ย window.location.replace("Login.html"); 
ย ย ย ย ย ย throw new Error("Sessรฃo invรกlida.");
ย ย ย ย }
ย ย ย ย // --- FIM DO PROTETOR DE PรGINA ---
ย ย </script>
ย ย <link rel="stylesheet" href="css/dashboard.css">
ย ย <link rel="icon" type="image/png" href="/logo.png">
ย ย <link rel="stylesheet" href="css/imprimir.css">

ย ย <style>
ย ย ย ย /* Estilos do Header (Inalterados) */
ย ย ย ย .header {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย justify-content: space-between; 
ย ย ย ย ย ย padding: 0.75rem 2rem;
ย ย ย ย ย ย background-color: #ffffff;
ย ย ย ย ย ย border-bottom: 1px solid #dee2e6;
ย ย ย ย ย ย box-shadow: 0 2px 5px rgba(0,0,0,0.05);
ย ย ย ย ย ย position: sticky;
ย ย ย ย ย ย top: 0;
ย ย ย ย ย ย z-index: 1030;
ย ย ย ย }
ย ย ย ย .logo {
ย ย ย ย ย ย font-size: 1.4rem;
ย ย ย ย ย ย font-weight: 700;
ย ย ย ย ย ย color: #0d6efd;
ย ย ย ย ย ย text-transform: uppercase;
ย ย ย ย ย ย letter-spacing: 0.5px;
ย ย ย ย ย ย margin: 0;
ย ย ย ย ย ย white-space: nowrap;
ย ย ย ย }
ย ย ย ย .search-bar {
ย ย ย ย ย ย margin-left: 2rem;
ย ย ย ย ย ย margin-right: 2rem;
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย max-width: 450px;
ย ย ย ย }
ย ย ย ย .search-bar input {
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย padding: 0.6rem 1rem;
ย ย ย ย ย ย border: 1px solid #ced4da;
ย ย ย ย ย ย border-radius: 20px;
ย ย ย ย ย ย font-size: 0.95rem;
ย ย ย ย }
ย ย ย ย .search-bar input:focus {
ย ย ย ย ย ย border-color: #86b7fe;
ย ย ย ย ย ย box-shadow: 0 0 0 0.25rem rgba(13,110,253,.25);
ย ย ย ย ย ย outline: none;
ย ย ย ย }
ย ย ย ย 
ย ย ย ย /* Estilos para Logout (Inalterados) */
ย ย ย ย .header-actions {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย gap: 1rem; 
ย ย ย ย }
ย ย ย ย #userNameDisplay {
ย ย ย ย ย ย font-weight: 500;
ย ย ย ย ย ย color: #495057;
ย ย ย ย ย ย white-space: nowrap; 
ย ย ย ย }
ย ย ย ย .btn-logout {
ย ย ย ย ย ย background-color: #dc3545; 
ย ย ย ย ย ย color: white;
ย ย ย ย ย ย border: none;
ย ย ย ย ย ย padding: 0.5rem 1rem;
ย ย ย ย ย ย border-radius: 6px;
ย ย ย ย ย ย font-weight: 500;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย ย ย transition: background-color 0.2s ease;
ย ย ย ย }
ย ย ย ย .btn-logout:hover {
ย ย ย ย ย ย background-color: #bb2d3b;
ย ย ย ย }

ย ย ย ย /* AJUSTES DA SIDEBAR PARA ALINHAMENTO DO TEXTO LONGO */
        /* Estas regras devem estar em 'dashboard.css', mas incluรญdas aqui para garantir */
        
        /* 1. Garante que os links da sidebar usem Flexbox */
        .sidebar nav ul li a {
            display: flex;
            align-items: center; /* Alinha o รญcone e o texto verticalmente */
            text-decoration: none;
            padding: 10px 15px; /* Padding ajustado */
            width: 100%;
        }

        /* 2. Garante o espaรงamento e largura fixa para o รญcone */
        .sidebar .icon {
            margin-right: 10px; /* Espaรงo entre o รญcone e o texto */
            min-width: 20px; /* Garante que o รญcone 'โ๏ธ' nรฃo desloque o texto */
            text-align: center;
        }

        /* 3. Permite que o texto preencha o restante e evita quebras */
        .sidebar .text {
            flex-grow: 1; 
            white-space: nowrap;
        }
ย ย </style>
</head> 
<body>

ย ย <div class="dashboard-container">
ย ย ย ย 
ย ย ย ย <header class="header">
ย ย ย ย ย ย <div class="logo">PORTAL SUPERMERCADO ROSALINA</div> 
ย ย ย ย ย ย <div class="search-bar">
ย ย ย ย ย ย ย ย <input type="text" placeholder="Buscar produtos, relatรณrios, chamados...">
ย ย ย ย ย ย </div>
ย ย ย ย ย ย 
ย ย ย ย ย ย ย<div class="header-actions">
ย ย ย ย ย ย ย ย <span id="userNameDisplay"></span>
ย ย ย ย ย ย ย ย <button id="logoutButton" class="btn-logout">Sair</button>
ย ย ย ย ย ย </div>
ย ย ย ย </header>
ย ย ย ย 
ย ย ย ย <aside class="sidebar">
ย ย ย ย ย ย <nav>
ย ย ย ย ย ย ย ย <ul>
ย ย ย ย ย ย ย ย ย ย <li>
ย ย ย ย ย ย ย ย ย ย ย ย <a href="Dashboard.html" title="Inรญcio">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="icon">๐</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="text">Inรญcio</span>
ย ย ย ย ย ย ย ย ย ย ย ย </a>
ย ย ย ย ย ย ย ย ย ย </li>
ย ย ย ย ย ย ย ย ย ย 
ย ย ย ย ย ย ย ย ย ย <li class="active"> <a href="Imprimir.html" title="Impressรฃo de Preรงos">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="icon">๐จ๏ธ</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="text">Imprimir</span>
ย ย ย ย ย ย ย ย ย ย ย ย </a>
ย ย ย ย ย ย ย ย ย ย </li>

ย ย ย ย ย ย ย ย ย ย <li class="ticket-item" id="menu-link-chamado"> 
ย ย ย ย ย ย ย ย ย ย ย ย <a href="Chamado.html" title="Abrir Chamado (Airus)"> 
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="icon">โ</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="text">Chamado</span>
ย ย ย ย ย ย ย ย ย ย ย ย </a>
ย ย ย ย ย ย ย ย ย ย </li>

ย ย ย ย ย ย ย ย ย ย <li>
ย ย ย ย ย ย ย ย ย ย ย ย <a href="Chatbot.html" title="Chatbot">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="icon">๐ค</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="text">Chatbot</span>
ย ย ย ย ย ย ย ย ย ย ย ย </a>
ย ย ย ย ย ย ย ย ย ย </li>

ย ย ย ย ย ย ย ย ย ย <li>
ย ย ย ย ย ย ย ย ย ย ย ย <a href="Funcionarios.html" title="funcionario">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="icon">๐ผ</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="text">Funcionรกrios</span>
ย ย ย ย ย ย ย ย ย ย ย ย </a>
ย ย ย ย ย ย ย ย ย ย </li>

ย ย ย ย ย ย ย ย ย ย <li style="margin-top: 30px;">
ย ย ย ย ย ย ย ย ย ย ย ย <a href="#" title="Configuraรงรตes">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="icon">โ๏ธ</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="text">Ajustes</span>
ย ย ย ย ย ย ย ย ย ย ย ย </a>
ย ย ย ย ย ย ย ย ย ย </li>
ย ย ย ย ย ย ย ย </ul>
ย ย ย ย ย ย </nav>
ย ย ย ย </aside>
ย ย ย ย 
ย ย ย ย <main class="main-content">
ย ย ย ย ย ย <h1>Impressรฃo de Etiquetas de Preรงo</h1>
ย ย ย ย ย ย 
ย ย ย ย ย ย <div class="widget">
ย ย ย ย ย ย ย ย <h3>Buscar Produto</h3>
ย ย ย ย ย ย ย ย <div class="search-container">
ย ย ย ย ย ย ย ย ย ย <input type="text" id="searchInput" placeholder="Digite o nome ou cรณdigo de barras do produto...">
ย ย ย ย ย ย ย ย ย ย <button id="searchButton" class="btn-primary">Buscar</button>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>

ย ย ย ย ย ย <div class="widget">
ย ย ย ย ย ย ย ย <h3>Resultados da Busca</h3>
ย ย ย ย ย ย ย ย <table class="results-table">
ย ย ย ย ย ย ย ย ย ย <thead>
ย ย ย ย ย ย ย ย ย ย ย ย <tr>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th><input type="checkbox" id="selectAll"></th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th>Produto</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th>Cรณdigo EAN</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th>Preรงo (R$)</th>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <th>Tipo de Etiqueta</th>
ย ย ย ย ย ย ย ย ย ย ย ย </tr>
ย ย ย ย ย ย ย ย ย ย </thead>
ย ย ย ย ย ย ย ย ย ย <tbody id="resultsBody">
ย ย ย ย ย ย ย ย ย ย ย ย <tr>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td><input type="checkbox" class="select-item"></td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td>Arroz Agulhinha Tipo 1 (5kg)</td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td>7890000123456</td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td class="price">24,90</td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td>Gรดndola (P)</td>
ย ย ย ย ย ย ย ย ย ย ย ย </tr>
ย ย ย ย ย ย ย ย ย ย ย ย <tr>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td><input type="checkbox" class="select-item"></td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td>Refrigerante Cola 2L</td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td>7890000654321</td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td class="price">8,99</td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td>Gรดndola (P)</td>
ย ย ย ย ย ย ย ย ย ย ย ย </tr>
ย ย ย ย ย ย ย ย ย ย ย ย <tr>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td><input type="checkbox" class="select-item"></td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td>Picanha Bovina (kg)</td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td>7890000789012</td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td class="price">79,90</td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td>Aรงougue (M)</td>
ย ย ย ย ย ย ย ย ย ย ย ย </tr>
ย ย ย ย ย ย ย ย ย ย </tbody>
ย ย ย ย ย ย ย ย </table>
ย ย ย ย ย ย ย ย <div class="print-actions">
ย ย ย ย ย ย ย ย ย ย <button id="printButton" class="btn-print">๐จ๏ธ Imprimir Selecionados</button>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย </main>
ย ย ย ย 
ย ย </div>

ย ย <div id="print-preview">
ย ย ย ย <div class="price-tag">
ย ย ย ย ย ย <div class="tag-header">PORTAL SUPERMERCADO</div>
ย ย ย ย ย ย <div class="tag-body">
ย ย ย ย ย ย ย ย <div class="tag-desc">Arroz Agulhinha Tipo 1 (5kg)</div>
ย ย ย ย ย ย ย ย <div class="tag-price">
ย ย ย ย ย ย ย ย ย ย <span class="tag-currency">R$</span>
ย ย ย ย ย ย ย ย ย ย <span class="tag-value">24</span>
ย ย ย ย ย ย ย ย ย ย <span class="tag-cents">,90</span>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div class="tag-barcode">
ย ย ย ย ย ย ย ย ย ย (Simulaรงรฃo de Cรณd. Barras)
ย ย ย ย ย ย ย ย ย ย <div class="barcode-lines">||| || ||| || ||||</div>
ย ย ย ย ย ย ย ย ย ย 7890000123456
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </div>

<script type="module">
ย ย document.addEventListener('DOMContentLoaded', () => {
ย ย ย ย 
ย ย ย ย // --- FUNรรO DE LOGOUT ---
ย ย ย ย function fazerLogout() {
ย ย ย ย ย ย localStorage.removeItem("userData"); 
ย ย ย ย ย ย window.location.href = "Login.html"; 
ย ย ย ย }

ย ย ย ย // --- NOME DE USUรRIO E AJUSTE DE MENU ---
ย ย ย ย const userDataString = localStorage.getItem("userData");
ย ย ย ย try {
ย ย ย ย ย ย const userData = JSON.parse(userDataString); 
ย ย ย ย ย ย const userNameDisplay = document.getElementById('userNameDisplay'); 

ย ย ย ย ย ย if (userNameDisplay && userData?.data?.nomeFuncionario) {
ย ย ย ย ย ย ย ย userNameDisplay.textContent = `Olรก, ${userData.data.nomeFuncionario.split(' ')[0]}`;
ย ย ย ย ย ย }

ย ย ย ย ย ย // LรGICA DE AJUSTE DINรMICO DO MENU
ย ย ย ย ย ย const userPerfil = userData?.data?.perfil; 
ย ย ย ย ย ย const linkChamadoLi = document.getElementById("menu-link-chamado"); 
ย ย ย ย ย ย 
ย ย ย ย ย ย if (linkChamadoLi && (userPerfil === 'AGENTE' || userPerfil === 'ADMIN')) {
ย ย ย ย ย ย ย ย const a = linkChamadoLi.querySelector('a');
ย ย ย ย ย ย ย ย a.href = "GerenciarChamados.html"; 
ย ย ย ย ย ย ย ย a.title = "Gerenciar Chamados";
ย ย ย ย ย ย ย ย a.querySelector('.icon').textContent = "โ๏ธ"; 
ย ย ย ย ย ย ย ย a.querySelector('.text').textContent = "Gerenciar Chamados";
ย ย ย ย ย ย }
ย ย ย ย ย ย // FIM DA LรGICA DE AJUSTE

ย ย ย ย } catch (error) {
ย ย ย ย ย ย console.error("Erro ao processar dados do usuรกrio:", error);
ย ย ย ย ย ย fazerLogout();
ย ย ย ย }
ย ย ย ย 
ย ย ย ย // --- EVENT LISTENER DE LOGOUT ---
ย ย ย ย const btnLogout = document.getElementById("logoutButton");
ย ย ย ย if (btnLogout) {
ย ย ย ย ย ย btnLogout.addEventListener('click', fazerLogout);
ย ย ย ย }
ย ย });
</script>

</body>
</html>